---
title: docker
author: cotes
date: 2024-11-10 17:20:00 +0800
categories: [æ˜Ÿæ²³é£é›ªè®¡åˆ’]
tags: [æ˜Ÿæ²³é£é›ªè®¡åˆ’-äº‘è®¡ç®—]
pin: true
comments: true
---

### å®‰è£…docker

---

#### centos

1. é¦–å…ˆç¡®å®šcentoså†…æ ¸ç‰ˆæœ¬æ˜¯3.10ä»¥ä¸Šï¼Œ3.8ä»¥ä¸Šè²Œä¼¼ä¹Ÿå¯ä»¥

   1. uname -ræŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬

   2. å°tipsï¼š

      yum update : å‡çº§æ‰€æœ‰åŒ…åŒæ—¶ä¹Ÿå‡çº§è½¯ä»¶å’Œç³»ç»Ÿå†…æ ¸

      yum upgrade : åªå‡çº§æ‰€æœ‰åŒ…ï¼Œä¸å‡çº§è½¯ä»¶å’Œç³»ç»Ÿå†…æ ¸

   3. å¦‚æœä¹‹å‰å®‰è£…è¿‡çš„è¯ï¼Œéœ€è¦å¸è½½æ—§ç‰ˆæœ¬
   	
   	```
   	yum remove docker docker-common docker-selinux docker-engine
   	```

2. å®‰è£…Docker-CEçš„åŸºæœ¬ç¯å¢ƒï¼Œyum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–
  ```
  yum install -y yum-utils device-mapper-persistent-data lvm2
  ```

3. è®¾ç½®yumæº
  ```
  é¡ºä¾¿è®¾ç½®å¥½yumæº
  â‘ å¤‡ä»½ï¼šsudo mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
  â‘¡ä¸‹è½½å›½å†…æºçš„ YUM é…ç½®æ–‡ä»¶ï¼š
  	é˜¿é‡Œäº‘ï¼šsudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repoæˆ–ä½¿ç”¨curl
  	æ¸…åï¼šsudo wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.tuna.tsinghua.edu.cn/repo/Centos-7.repo
  â‘¢æ¸…ç† YUM ç¼“å­˜ï¼š
  	sudo yum clean all
  	sudo yum makecache
  â‘£æ£€éªŒï¼šsudo yum repolist
  yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
  ```

4. é€‰æ‹©dockerç‰ˆæœ¬å¹¶å®‰è£…
  1. æŸ¥çœ‹å¯ä»¥ç‰ˆæœ¬æœ‰å“ªäº›
      ```
      yum list docker-ce --showduplicates | sort -r
      ```

  2. é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬å®‰è£…
      ```
      yum install docker-ce-ç‰ˆæœ¬å·
      ```
      

  ğŸŒŸå¯ä»¥ç›´æ¥å®‰è£…é»˜è®¤ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

  ```
  yum update -y
  yum install docker-ce docker-ce-cli containerd.io
  ```

5. è®¾ç½®å¼€æœºè‡ªå¯
  ```
  systemctl enable docker
  systemctl dsiable docker
  ```

6. dockerå¸¸ç”¨å‘½ä»¤
  1. å¯åŠ¨ã€å…³é—­ã€é‡å¯docker
      ```
      systemctl start docker
      systemctl stop docker
      systemctl restart docker
      ```

  2. æŸ¥çœ‹dockerçŠ¶æ€ã€ä¿¡æ¯

      ```
      systemctl status docker	#æŸ¥çœ‹dockeræœåŠ¡çŠ¶æ€ running å°±æ˜¯å¯åŠ¨æˆåŠŸ
      docker info 	#æ›´æ–°dockeråŠ é€Ÿæºåå¯ä»¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼Œæ£€æŸ¥Registry Mirrors:
      ```

  3. å…¶ä»–

     ```
     #é•œåƒå‘½ä»¤
     docker imagesï¼šåˆ—å‡ºæ‰€æœ‰é•œåƒ
     docker search [image]ï¼šæœç´¢ Docker é•œåƒ
     docker pull [image]ï¼šæ‹‰å–æŒ‡å®šé•œåƒ
     docker rmi [image]ï¼šåˆ é™¤æŒ‡å®šé•œåƒ
     #å®¹å™¨å‘½ä»¤
     docker psï¼šåˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨
     docker ps -aï¼šåˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬å·²ç»åœæ­¢çš„å®¹å™¨
     docker create [image]ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œä½†ä¸å¯åŠ¨å®ƒ
     docker start [container]ï¼šå¯åŠ¨ä¸€ä¸ªå®¹å™¨
     docker stop [container]ï¼šåœæ­¢ä¸€ä¸ªå®¹å™¨
     docker rm [container]ï¼šåˆ é™¤ä¸€ä¸ªå®¹å™¨
     docker exec -it [container] [command]ï¼šåœ¨è¿è¡Œä¸­çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
     #å…¶ä»–å‘½ä»¤
     docker infoï¼šæ˜¾ç¤º Docker ç³»ç»Ÿä¿¡æ¯
     docker versionï¼šæ˜¾ç¤º Docker ç‰ˆæœ¬ä¿¡æ¯
     docker logs [container]ï¼šæŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—
     docker network lsï¼šåˆ—å‡º Docker ç½‘ç»œ
     docker network create [network]ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker ç½‘ç»œ
     docker network connect [network] [container]ï¼šå°†å®¹å™¨è¿æ¥åˆ°æŒ‡å®šçš„ Docker ç½‘ç»œ
     docker network disconnect [network] [container]ï¼šå°†å®¹å™¨ä»æŒ‡å®šçš„ Docker ç½‘ç»œä¸­æ–­å¼€è¿æ¥ 
     ```

7. è®¾ç½®dockeråŠ é€Ÿæº

   ```
   mkdir -p /etc/docker	#ä¿®æ”¹(åˆ›å»º)ç›®å½•
   vi /etc/docker/daemon.json	#ç¼–è¾‘ã€åˆ›å»º/etc/docker/daemon.jsonæ–‡ä»¶
   ```

   ```
   {
     "registry-mirrors": [
   	"https://docker.1ms.run",
   	"https://hub.geekery.cn",
   	"https://dockerpull.com",
   	"https://docker.1panel.dev"
   ]
   }
   ```

   ```
   systemctl daemon-reload 	#ä»»ä½•æ—¶å€™ä½ ä¿®æ”¹äº†systemdç®¡ç†çš„æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œéƒ½åº”è¯¥æ‰§è¡Œsystemctl daemon-reloadæ¥ç¡®ä¿æ›´æ”¹è¢«æ­£ç¡®åŠ è½½ã€‚
   systemctl restart docker	#ç„¶åé‡å¯å¯¹åº”æœåŠ¡(docker)
   ```

8. æµ‹è¯•

   ```
   docker run hello-world
   ```

   

#### kali linux

1. æ›´æ–°ç³»ç»Ÿå’Œæ¢æº

   1. ```
      apt-get update
      apt-get upgrade
      ```

   2. ```
      cp /etc/apt/sources.list /etc/apt/sources.list.backup
      vim /etc/apt/sources.list 	#æˆ–è€…ä½¿ç”¨nanoå·¥å…·ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ nanoï¼ŒæŒ‰ Ctrl + Xï¼Œç„¶åæŒ‰ Y ç¡®è®¤ä¿å­˜æ›´æ”¹ï¼Œæœ€åæŒ‰ Enter é”®é€€å‡ºã€‚
      ```

   3. ```
      deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main non-free contrib
      deb-src http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main non-free contrib
      
      deb http://mirrors.tuna.tsinghua.edu.cn/kali-security kali-rolling/updates main contrib non-free
      deb-src http://mirrors.tuna.tsinghua.edu.cn/kali-security kali-rolling/updates main contrib non-free
      
      deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling/updates main non-free contrib
      deb-src http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling/updates main non-free contrib
      ```

2. å®‰è£…docker

   ````
   sudo apt-get update
   sudo apt-get install docker.io
   ````

3. æ£€æŸ¥

   ```
   docker -v
   æˆ–docker version
   ```

4. å¯åŠ¨ã€è®¾ç½®è‡ªå¯åŠ¨

   ```
   systemctl start docker
   systemctl enable docker
   ```

5. é…ç½®ä¸­å›½é•œåƒæº
   ```
   mkdir -p /etc/docker	#ä¿®æ”¹(åˆ›å»º)ç›®å½•
   vim /etc/docker/daemon.json	#ç¼–è¾‘ã€åˆ›å»º/etc/docker/daemon.jsonæ–‡ä»¶
   ```

   ```
   {
     "registry-mirrors": [
   	"https://docker.1ms.run",
   	"https://hub.geekery.cn",
   	"https://dockerpull.com",
   	"https://docker.1panel.dev"
   ]
   }
   ```

   ```
   systemctl daemon-reload 	#ä»»ä½•æ—¶å€™ä½ ä¿®æ”¹äº†systemdç®¡ç†çš„æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œéƒ½åº”è¯¥æ‰§è¡Œsystemctl daemon-reloadæ¥ç¡®ä¿æ›´æ”¹è¢«æ­£ç¡®åŠ è½½ã€‚
   systemctl restart docker	#ç„¶åé‡å¯å¯¹åº”æœåŠ¡(docker)
   ```

6. æ£€æŸ¥ Docker æœåŠ¡çš„è¿è¡ŒçŠ¶æ€

   ```
   systemctl status docker.service
   ```

   
   
   å¯¼å…¥å®¹å™¨ï¼šdocker run -it --name my_centos7 centos:7 /bin/bashæˆ–è€…docker pull centos:7
   
   - `docker run`ï¼šè¿™æ˜¯Docker CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰ç”¨æ¥åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨çš„å‘½ä»¤ã€‚
   
   - `-it`ï¼šè¿™æ˜¯ä¸¤ä¸ªå‚æ•°çš„ç»„åˆï¼Œ`-i`ï¼ˆæˆ–`--interactive`ï¼‰ä¿æŒå®¹å™¨çš„æ ‡å‡†è¾“å…¥ï¼ˆSTDINï¼‰æ‰“å¼€ï¼Œå³ä½¿ä¸é™„åŠ åˆ°å®¹å™¨ç»ˆç«¯ï¼Œ`-t`ï¼ˆæˆ–`--tty`ï¼‰åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚è¿™ä¸¤ä¸ªå‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥è®©ä½ ä¸å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹è¿›è¡Œäº¤äº’ã€‚
   
     **`-d` å‚æ•°ä»£è¡¨â€œdetachedâ€æ¨¡å¼ï¼Œå³ *åˆ†ç¦»æ¨¡å¼*  æˆ–  *åå°æ¨¡å¼* ã€‚å½“ä½ ä½¿ç”¨ `docker run -d` æ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œå®¹å™¨ä¼šåœ¨åå°è¿è¡Œï¼Œå¹¶ä¸”ä½ å°†ç«‹å³è¿”å›åˆ°å‘½ä»¤è¡Œç•Œé¢ï¼Œè€Œä¸æ˜¯ä¿æŒä¸å®¹å™¨çš„äº¤äº’å¼ä¼šè¯ã€‚**
   
   - `-name my_centos7`ï¼šè¿™ä¸ªå‚æ•°ä¸ºæ–°åˆ›å»ºçš„å®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œè¿™é‡Œæ˜¯`my_centos7`ã€‚
   
   - `centos:7`ï¼šè¿™æ˜¯Dockeré•œåƒçš„åç§°å’Œæ ‡ç­¾ï¼ŒæŒ‡å®šäº†è¦ä½¿ç”¨çš„é•œåƒã€‚åœ¨è¿™é‡Œï¼Œä½¿ç”¨çš„æ˜¯CentOS 7çš„å®˜æ–¹é•œåƒã€‚
   
   - `/bin/bash`ï¼šè¿™æ˜¯å®¹å™¨å¯åŠ¨åè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™é‡Œæ˜¯å¯åŠ¨bash shellã€‚
   
   
   
   åç»­è¿è¡Œcentos7å®¹å™¨ï¼š
   
   ```
   docker start my_centos7 	#å¼€å¯
   docker exec -it my_centos7 bash 	#è¿è¡Œå®¹å™¨
   docker stop my_centos7 	#å…³é—­
   ```
   
   cat /etc/os-release 
   
   ![QQ_1731214465478](docker.assets/QQ_1731214465478.png)
   
   å¯¼å…¥æ–¹æ³•2ï¼š
   
   ```
   docker load -i xx.tar
   ```
   
   ```
   å¦‚æœè¿™ä¸ªimagesç”¨çš„å¾ˆå¤šï¼Œå¯ä»¥ sudo docker save -o xxx.tag centos:7   è¿™æ ·å°±å¯ä»¥æŠŠimagesä¿å­˜åœ¨å½“å‰ç›®å½•xxx.tagï¼Œç„¶åæŠŠé•œåƒå¯ä»¥å¤åˆ¶åˆ°ç‰©ç†æœº(å¯èƒ½æ²¡æƒé™å¤åˆ¶ï¼Œæ”¹ä¸ªæƒé™å°±å¯ä»¥)ã€‚
   
   å¦‚æœä¸‹æ¬¡é‡æ–°è£…äº†kaliï¼Œdockerè£…å¥½çš„æƒ…å†µä¸‹ï¼ŒæŠŠç‰©ç†æœºçš„imageså¤åˆ¶è¿›æ¥ï¼Œç”¨sudo docker load -i xxx.tag 
   è¿™æ ·å°±ä¸ç”¨å†ç”¨ docker pull æ‹‰äº†ã€‚
   ```
   

#### å®¹å™¨ä¸äº‘

åˆ›å»ºApacheå®¹å™¨åå°è¿è¡Œ

```
docker container run -d --rm -p 8080:80 httpd 	#æ‹‰å–httpdé•œåƒ
curl localhost:8080 	#æœ‰å›æ˜¾æ ‡ç­¾å°±è¯´æ˜å®‰è£…æˆåŠŸ
```

#### dockerå¸¸ç”¨å‘½ä»¤

containeræœ‰æ—¶å€™å¯ä»¥çœç•¥

```
docker container ls 	#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨
docker ps -a 	#æŸ¥çœ‹æ‰€ä»¥å·²åˆ›å»ºçš„å®¹å™¨
docker top <names or container id> 	#æŸ¥çœ‹ç‰¹å®šå®¹å™¨çš„è¿›ç¨‹ä¿¡æ¯
docker exec -it <names or container id> /bin/bash 	#ç™»å½•åå°è¿è¡Œçš„å®¹å™¨
docker container stop <names or container id> 	#åœæ­¢å®¹å™¨

docker container run -d --rm -p 8080:80 -v /home/user/webroot/:/usr/local/apache2/htdoces/ httpd
#æŒ‚è½½å®¿ä¸»æœºç›®å½•
--rm :è®¾ç½®å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤
```



